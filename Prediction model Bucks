import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error

# Laad de dataset
df = pd.read_excel('NBA Games.xlsx')

# Feature engineering en data voorbereiding
# Filter data for Milwaukee (MIL) team
milwaukee_data = df[df['TEAM_ABBREVIATION'] == 'MIL']

# Group by 'GAME_ID' and sum the points for Milwaukee
milwaukee_scores = milwaukee_data.groupby('GAME_ID')['PTS'].sum().reset_index()

# Merge the total Milwaukee scores back to the original dataframe
df = pd.merge(df, milwaukee_scores, how='left', on='GAME_ID', suffixes=('', '_MIL'))

# Assuming 'PTS' represents the total points scored for the opponent
df['OPP_Score'] = df['PTS'] - df['PTS_MIL']

# Add a label column based on the comparison of scores
df['Label'] = df.apply(lambda row: 1 if row['PTS_MIL'] > row['OPP_Score'] else 0, axis=1)

# Split de data in trainings- en testssets
train_data, test_data = train_test_split(df, test_size=0.2, random_state=42)

# Kies features (X) en labels (y) voor training
X_train = train_data[['FGM',	'FGA',	'FG_PCT',	'FG3M',	'FG3A',	'FG3_PCT',	'FTM',	'FTA',	'FT_PCT',	'OREB',	'DREB',	'REB',	'AST',	'STL',	'BLK',	'TO',	'PF', 'PTS',	'PLUS_MINUS'
]]
y_train = train_data['score_difference']

# Kies features (X) en labels (y) voor testing
X_test = test_data[['FGM',	'FGA',	'FG_PCT',	'FG3M',	'FG3A',	'FG3_PCT',	'FTM',	'FTA',	'FT_PCT',	'OREB',	'DREB',	'REB',	'AST',	'STL',	'BLK',	'TO',	'PF', 'PTS',	'PLUS_MINUS']]
y_test = test_data['score_difference']

# Initialiseer het regressiemodel (bijv. Random Forest Regressor)
model = RandomForestRegressor()

# Train het model
model.fit(X_train, y_train)

# Voorspellingen doen voor de testsset
predictions = model.predict(X_test)

# Evalueer het model
mse = mean_squared_error(y_test, predictions)
print(f'Mean Squared Error: {mse}')

# Voorspellingen doen voor toekomstige games
future_games_features = ...  # features voor toekomstige games
future_predictions = model.predict(future_games_features)

